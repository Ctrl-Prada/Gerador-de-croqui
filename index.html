<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GalpON</title>
  
  <!-- 1. Carrega o Tailwind CSS para estilização -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- 2. Carrega as bibliotecas React e ReactDOM -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  
  <!-- 3. Carrega o Babel para traduzir JSX no navegador -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
  
  <!-- 4. Onde a aplicação React será renderizada -->
  <div id="root"></div>

  <!-- 5. Nosso código React (com o tipo "text/babel") -->
  <script type="text/babel">
    const { useState, useRef, useEffect } = React;

    // --- Componentes de Ícones (Substituindo lucide-react) ---
    const Icon = ({ className, children }) => (
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        strokeWidth="2"
        strokeLinecap="round"
        strokeLinejoin="round"
        className={className}
      >
        {children}
      </svg>
    );

    const DownloadIcon = ({ className }) => (
      <Icon className={className}>
        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
        <polyline points="7 10 12 15 17 10" />
        <line x1="12" y1="15" x2="12" y2="3" />
      </Icon>
    );

    const FileTextIcon = ({ className }) => (
      <Icon className={className}>
        <path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z" />
        <path d="M14 2v4a2 2 0 0 0 2 2h4" />
        <path d="M16 13H8" />
        <path d="M16 17H8" />
        <path d="M10 9H8" />
      </Icon>
    );

    const RulerIcon = ({ className }) => (
      <Icon className={className}>
        <path d="M21.3 15.3a2.4 2.4 0 0 1 0 3.4l-2.6 2.6a2.4 2.4 0 0 1-3.4 0L3 8.4a2.4 2.4 0 0 1 0-3.4l2.6-2.6a2.4 2.4 0 0 1 3.4 0L18 11.6a2.4 2.4 0 0 0 3.3.1z" />
        <path d="m17.6 7.8 1.6 1.6" />
        <path d="m14 11.2 1.5 1.5" />
        <path d="m11 14.1 1.5 1.5" />
        <path d="m8.1 17.1 1.5 1.5" />
        <path d="m21.3 15.3-.1-2.9-2.9-.1" />
      </Icon>
    );

    const ArrowUpDownIcon = ({ className }) => (
      <Icon className={className}>
        <path d="m21 16-4 4-4-4" />
        <path d="M17 20V4" />
        <path d="m3 8 4-4 4 4" />
        <path d="M7 4v16" />
      </Icon>
    );
    
    // --- O seu componente principal ---
    function GalpaoSketchGenerator() {
      const [projectName, setProjectName] = useState('');
      const [comprimento, setComprimento] = useState('');
      const [largura, setLargura] = useState('');
      const [peDireito, setPeDireito] = useState('');
      const [sentidoPerfilado, setSentidoPerfilado] = useState('nao-informar');
      const [numPerfilados, setNumPerfilados] = useState('');
      const [distanciaPerfilados, setDistanciaPerfilados] = useState('');
      const [sketchGenerated, setSketchGenerated] = useState(false);
      const [error, setError] = useState('');
      const canvasRef = useRef(null);
      
      const handleInputChange = (setter) => (e) => {
          setter(e.target.value);
          if (error) setError('');
      };

      const generateSketch = () => {
        if (!comprimento || !largura || !peDireito) {
          setError('Por favor, preencha todos os campos obrigatórios (*).');
          return;
        }
        setError('');

        const canvas = canvasRef.current;
        if (!canvas) return;
        const ctx = canvas.getContext('2d');
        if (!ctx) return;
        
        const canvasWidth = 800;
        const canvasHeight = 600;
        canvas.width = canvasWidth;
        canvas.height = canvasHeight;

        ctx.fillStyle = '#ffffff';
        ctx.fillRect(0, 0, canvasWidth, canvasHeight);

        const comp = parseFloat(comprimento);
        const larg = parseFloat(largura);
        const pd = parseFloat(peDireito);

        const margin = 120;
        const availableWidth = canvasWidth - 2 * margin;
        const availableHeight = canvasHeight - 2 * margin - 80;
        const scale = Math.min(availableWidth / comp, availableHeight / larg);

        const rectWidth = comp * scale;
        const rectHeight = larg * scale;
        
        const startX = (canvasWidth - rectWidth) / 2;
        const startY = (canvasHeight - rectHeight) / 2 + 40;

        const today = new Date().toLocaleDateString('pt-BR');
        const titleText = projectName 
            ? `${projectName} - ${today}`
            : `Croqui Preliminar de Galpão - ${today}`;
        
        ctx.fillStyle = '#1e293b';
        ctx.font = 'bold 20px Arial';
        ctx.textAlign = 'center';
        ctx.fillText(titleText, canvasWidth / 2, 30);

        if (sentidoPerfilado === 'comprimento' || sentidoPerfilado === 'largura') {
            ctx.strokeStyle = '#94a3b8';
            ctx.lineWidth = 0.5;
            ctx.setLineDash([5, 5]);

            let numLines = 8;
            
            if (numPerfilados && parseInt(numPerfilados) > 0) {
                numLines = parseInt(numPerfilados);
            } else if (distanciaPerfilados && parseFloat(distanciaPerfilados) > 0) {
                const dist = parseFloat(distanciaPerfilados);
                if (sentidoPerfilado === 'comprimento') {
                    numLines = Math.floor(larg / dist) - 1;
                } else {
                    numLines = Math.floor(comp / dist) - 1;
                }
                numLines = Math.max(1, numLines);
            }
            
            if (sentidoPerfilado === 'comprimento') {
                const spacing = rectHeight / (numLines + 1);
                for (let i = 1; i <= numLines; i++) {
                    const y = startY + spacing * i;
                    ctx.beginPath();
                    ctx.moveTo(startX, y);
                    ctx.lineTo(startX + rectWidth, y);
                    ctx.stroke();
                }
            } else {
                const spacing = rectWidth / (numLines + 1);
                for (let i = 1; i <= numLines; i++) {
                    const x = startX + spacing * i;
                    ctx.beginPath();
                    ctx.moveTo(x, startY);
                    ctx.lineTo(x, startY + rectHeight);
                    ctx.stroke();
                }
            }
            ctx.setLineDash([]);
        }

        ctx.strokeStyle = '#1e293b';
        ctx.lineWidth = 3;
        ctx.strokeRect(startX, startY, rectWidth, rectHeight);

        ctx.strokeStyle = '#475569';
        ctx.fillStyle = '#475569';
        ctx.lineWidth = 1;
        ctx.font = 'bold 14px Arial';

        const cotaTopY = startY - 40;
        ctx.beginPath();
        ctx.moveTo(startX, cotaTopY);
        ctx.lineTo(startX + rectWidth, cotaTopY);
        ctx.stroke();
        
        ctx.beginPath();
        ctx.moveTo(startX, cotaTopY);
        ctx.lineTo(startX + 10, cotaTopY - 5);
        ctx.lineTo(startX + 10, cotaTopY + 5);
        ctx.closePath();
        ctx.fill();
        
        ctx.beginPath();
        ctx.moveTo(startX + rectWidth, cotaTopY);
        ctx.lineTo(startX + rectWidth - 10, cotaTopY - 5);
        ctx.lineTo(startX + rectWidth - 10, cotaTopY + 5);
        ctx.closePath();
        ctx.fill();
        
        ctx.beginPath();
        ctx.moveTo(startX, startY - 30);
        ctx.lineTo(startX, cotaTopY);
        ctx.moveTo(startX + rectWidth, startY - 30);
        ctx.lineTo(startX + rectWidth, cotaTopY);
        ctx.stroke();
        
        ctx.textAlign = 'center';
        ctx.fillText(`${comp.toFixed(2)} m`, startX + rectWidth / 2, cotaTopY - 10);

        const cotaRightX = startX + rectWidth + 40;
        ctx.beginPath();
        ctx.moveTo(cotaRightX, startY);
        ctx.lineTo(cotaRightX, startY + rectHeight);
        ctx.stroke();
        
        ctx.beginPath();
        ctx.moveTo(cotaRightX, startY);
        ctx.lineTo(cotaRightX - 5, startY + 10);
        ctx.lineTo(cotaRightX + 5, startY + 10);
        ctx.closePath();
        ctx.fill();
        
        ctx.beginPath();
        ctx.moveTo(cotaRightX, startY + rectHeight);
        ctx.lineTo(cotaRightX - 5, startY + rectHeight - 10);
        ctx.lineTo(cotaRightX + 5, startY + rectHeight - 10);
        ctx.closePath();
        ctx.fill();
        
        ctx.beginPath();
        ctx.moveTo(startX + rectWidth + 30, startY);
        ctx.lineTo(cotaRightX, startY);
        ctx.moveTo(startX + rectWidth + 30, startY + rectHeight);
        ctx.lineTo(cotaRightX, startY + rectHeight);
        ctx.stroke();
        
        ctx.save();
        ctx.translate(cotaRightX + 20, startY + rectHeight / 2);
        ctx.rotate(-Math.PI / 2);
        ctx.textAlign = 'center';
        ctx.fillText(`${larg.toFixed(2)} m`, 0, 0);
        ctx.restore();

        ctx.fillStyle = '#1e293b';
        ctx.font = 'bold 16px Arial';
        ctx.textAlign = 'left';
        const pdText = `Pé Direito: ${pd.toFixed(2)} m`;
        ctx.fillText(pdText, startX + 15, startY + 25);

        if (sentidoPerfilado !== 'nao-informar') {
            ctx.font = '12px Arial';
            ctx.fillStyle = '#64748b';
            const legendText = sentidoPerfilado === 'comprimento' 
                ? 'Perfilado paralelo ao comprimento' 
                : 'Perfilado paralelo à largura';
            ctx.fillText(legendText, startX + 15, startY + 45);
            
            if (numPerfilados) {
                ctx.fillText(`Quantidade: ${numPerfilados} perfilados`, startX + 15, startY + 60);
            } else if (distanciaPerfilados) {
                ctx.fillText(`Distância entre perfilados: ${distanciaPerfilados} m`, startX + 15, startY + 60);
            }
        }

        ctx.fillStyle = '#94a3b8';
        ctx.font = '10px Arial';
        ctx.textAlign = 'center';
        ctx.fillText('Documento preliminar para análise de engenharia', canvasWidth / 2, canvasHeight - 20);

        setSketchGenerated(true);
      };

      const downloadSketch = () => {
        const canvas = canvasRef.current;
        if (!canvas) return;
        
        canvas.toBlob((blob) => {
            if (!blob) return;
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            const safeProjectName = projectName.replace(/[^a-z0-9]/gi, '_').toLowerCase();
            const filename = projectName
              ? `croqui_${safeProjectName}_${comprimento}x${largura}m_${new Date().toISOString().split('T')[0]}.png`
              : `croqui_galpao_${comprimento}x${largura}m_${new Date().toISOString().split('T')[0]}.png`;
            link.download = filename;
            link.href = url;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }, 'image/png');
      };

      return (
        <div className="min-h-screen bg-gradient-to-br from-blue-50 to-slate-100 p-4 sm:p-6 font-sans">
          <div className="max-w-7xl mx-auto">
            {/* Header */}
            <header className="bg-white rounded-lg shadow-lg p-6 mb-6">
              <div className="flex items-center gap-3 mb-2">
                <FileTextIcon className="w-8 h-8 text-blue-600" />
                <h1 className="text-2xl sm:text-3xl font-bold text-slate-800">
                  GalpON
                </h1>
              </div>
              <p className="text-slate-600">
                Ferramenta para criação automática de esboços para a equipe de engenharia
              </p>
            </header>
            
            {/* Alterado para um grid de 3 colunas em telas grandes (lg) */}
            <main className="grid grid-cols-1 lg:grid-cols-3 gap-6">
              {/* Formulário (ocupa 1 de 3 colunas) */}
              <div className="bg-white rounded-lg shadow-lg p-6 lg:col-span-1">
                <h2 className="text-xl font-semibold text-slate-800 mb-4 flex items-center gap-2">
                  <RulerIcon className="w-5 h-5 text-blue-600" />
                  Dados do Galpão
                </h2>
                
                {error && (
                    <div className="bg-red-100 border-l-4 border-red-500 text-red-700 p-3 mb-4 rounded-md" role="alert">
                        <p>{error}</p>
                    </div>
                )}

                <div className="space-y-4">
                  <div>
                    <label className="block text-sm font-medium text-slate-700 mb-2">
                      Nome do Projeto
                    </label>
                    <input
                      type="text"
                      value={projectName}
                      onChange={(e) => setProjectName(e.target.value)}
                      className="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition"
                      placeholder="Ex: Galpão Logístico"
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-medium text-slate-700 mb-2">
                      Comprimento (metros) *
                    </label>
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      value={comprimento}
                      onChange={handleInputChange(setComprimento)}
                      onWheel={(e) => e.target.blur()}
                      className="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition"
                      placeholder="Ex: 50.00"
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-slate-700 mb-2">
                      Largura (metros) *
                    </label>
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      value={largura}
                      onChange={handleInputChange(setLargura)}
                      onWheel={(e) => e.target.blur()}
                      className="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition"
                      placeholder="Ex: 30.00"
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-slate-700 mb-2">
                      Pé Direito (metros) *
                    </label>
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      value={peDireito}
                      onChange={handleInputChange(setPeDireito)}
                      onWheel={(e) => e.target.blur()}
                      className="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition"
                      placeholder="Ex: 10.00"
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-slate-700 mb-3 flex items-center gap-2">
                      <ArrowUpDownIcon className="w-4 h-4" />
                      Sentido do Perfilado (Terças)
                    </label>
                    <div className="space-y-2">
                      <label className="flex items-center gap-2 p-3 border border-slate-200 rounded-lg cursor-pointer hover:bg-slate-50 transition-colors">
                        <input
                          type="radio"
                          name="perfilado"
                          value="comprimento"
                          checked={sentidoPerfilado === 'comprimento'}
                          onChange={(e) => setSentidoPerfilado(e.target.value)}
                          className="w-4 h-4 text-blue-600 focus:ring-blue-500"
                        />
                        <span className="text-sm text-slate-700">Paralelo ao Comprimento</span>
                      </label>
                      <label className="flex items-center gap-2 p-3 border border-slate-200 rounded-lg cursor-pointer hover:bg-slate-50 transition-colors">
                        <input
                          type="radio"
                          name="perfilado"
                          value="largura"
                          checked={sentidoPerfilado === 'largura'}
                          onChange={(e) => setSentidoPerfilado(e.target.value)}
                          className="w-4 h-4 text-blue-600 focus:ring-blue-500"
                        />
                        <span className="text-sm text-slate-700">Paralelo à Largura</span>
                      </label>
                      <label className="flex items-center gap-2 p-3 border border-slate-200 rounded-lg cursor-pointer hover:bg-slate-50 transition-colors">
                        <input
                          type="radio"
                          name="perfilado"
                          value="nao-informar"
                          checked={sentidoPerfilado === 'nao-informar'}
                          onChange={(e) => setSentidoPerfilado(e.target.value)}
                          className="w-4 h-4 text-blue-600 focus:ring-blue-500"
                        />
                        <span className="text-sm text-slate-700">Não Informar</span>
                      </label>
                    </div>
                  </div>

                  {sentidoPerfilado !== 'nao-informar' && (
                    <div className="bg-blue-50 p-4 rounded-lg space-y-4 border border-blue-200">
                      <p className="text-sm font-medium text-slate-700">
                        Informações adicionais do perfilado (opcional):
                      </p>
                      
                      <div>
                        <label className="block text-sm font-medium text-slate-700 mb-2">
                          Número de Perfilados
                        </label>
                        <input
                          type="number"
                          min="1"
                          value={numPerfilados}
                          onChange={(e) => {
                            setNumPerfilados(e.target.value);
                            if (e.target.value) setDistanciaPerfilados('');
                          }}
                          onWheel={(e) => e.target.blur()}
                          className="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition"
                          placeholder="Ex: 10"
                        />
                      </div>

                      <div className="text-center text-sm text-slate-500 font-medium">
                        OU
                      </div>

                      <div>
                        <label className="block text-sm font-medium text-slate-700 mb-2">
                          Distância entre Perfilados (metros)
                        </label>
                        <input
                          type="number"
                          step="0.01"
                          min="0"
                          value={distanciaPerfilados}
                          onChange={(e) => {
                            setDistanciaPerfilados(e.target.value);
                            if (e.target.value) setNumPerfilados('');
                          }}
                          onWheel={(e) => e.target.blur()}
                          className="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition"
                          placeholder="Ex: 2.50"
                        />
                      </div>

                      <p className="text-xs text-slate-600 italic">
                        * Preencha apenas um dos campos acima.
                      </p>
                    </div>
                  )}

                  <button
                    onClick={generateSketch}
                    className="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition-transform transform hover:scale-105 shadow-md hover:shadow-lg flex items-center justify-center gap-2"
                  >
                    <FileTextIcon className="w-5 h-5" />
                    GERAR ESBOÇO
                  </button>
                </div>
              </div>

              {/* Visualização do Croqui (ocupa 2 de 3 colunas) */}
              <aside className="bg-white rounded-lg shadow-lg p-6 lg:col-span-2">
                <div className="flex items-center justify-between mb-4">
                  <h2 className="text-xl font-semibold text-slate-800">
                    Pré-visualização
                  </h2>
                  {sketchGenerated && (
                    <button
                      onClick={downloadSketch}
                      className="bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded-lg transition-transform transform hover:scale-105 shadow-md hover:shadow-lg flex items-center gap-2 text-sm"
                    >
                      <DownloadIcon className="w-4 h-4" />
                      Baixar imagem
                    </button>
                  )}
                </div>

                <div className="border-2 border-slate-200 rounded-lg overflow-hidden bg-slate-50 flex items-center justify-center h-full min-h-[624px]">
                  {!sketchGenerated ? (
                    <div className="text-center text-slate-400">
                      <FileTextIcon className="w-16 h-16 mx-auto mb-3 opacity-50" />
                      <p className="text-lg">Preencha os dados e clique em "GERAR ESBOÇO"</p>
                    </div>
                  ) : null}
                  <canvas
                    ref={canvasRef}
                    className="w-full h-auto"
                    style={{ display: sketchGenerated ? 'block' : 'none' }}
                  />
                </div>
              </aside>
            </main>
          </div>
        </div>
      );
    }

    // --- Ponto de Entrada da Aplicação ---
    const container = document.getElementById('root');
    const root = ReactDOM.createRoot(container);
    root.render(<GalpaoSketchGenerator />);
  </script>

</body>
</html>

